"""
–ú–æ–π –†–∏—Å–∫: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ –∏–Ω—Å—É–ª—å—Ç–∞ –Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤
¬©Ô∏è 2025
"""

import streamlit as st
import pandas as pd
import plotly.graph_objects as go
from datetime import datetime
from stroke_risk_calculator import StrokeRiskCalculator, RiskLevel


def main():
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    st.set_page_config(
        page_title="–ú–æ–π –†–∏—Å–∫ - –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –∏–Ω—Å—É–ª—å—Ç–∞",
        page_icon="üß†",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    
    # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏
    st.markdown("""
    <style>
    .main-header {
        font-size: 2.5rem;
        color: #1E3A8A;
        text-align: center;
        margin-bottom: 2rem;
    }
    .risk-low {
        background-color: #D1FAE5;
        padding: 1rem;
        border-radius: 0.5rem;
        border-left: 5px solid #10B981;
    }
    .risk-moderate {
        background-color: #FEF3C7;
        padding: 1rem;
        border-radius: 0.5rem;
        border-left: 5px solid #F59E0B;
    }
    .risk-high {
        background-color: #FEE2E2;
        padding: 1rem;
        border-radius: 0.5rem;
        border-left: 5px solid #EF4444;
    }
    .risk-critical {
        background-color: #FECACA;
        padding: 1rem;
        border-radius: 0.5rem;
        border-left: 5px solid #DC2626;
    }
    .warning-box {
        background-color: #FFFBEB;
        border: 2px solid #FBBF24;
        padding: 1rem;
        border-radius: 0.5rem;
        margin: 1rem 0;
    }
    .footer {
        text-align: center;
        color: #6B7280;
        margin-top: 3rem;
        padding-top: 1rem;
        border-top: 1px solid #E5E7EB;
    }
    </style>
    """, unsafe_allow_html=True)
    
    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    st.markdown('<h1 class="main-header">üß† –ú–æ–π –†–∏—Å–∫</h1>', unsafe_allow_html=True)
    st.markdown("### –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –∏–Ω—Å—É–ª—å—Ç–∞ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 6 –º–µ—Å—è—Ü–µ–≤")
    
    # Disclaimer
    with st.expander("‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï", expanded=True):
        st.warning("""
        **–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Å–≤–µ—Ç–∏—Ç–µ–ª—å—Å–∫–æ-–ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º 
        –∏ –ù–ï –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏!**
        
        –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å:
        - –í–Ω–µ–∑–∞–ø–Ω–∞—è —Å–ª–∞–±–æ—Å—Ç—å –≤ —Ä—É–∫–µ/–Ω–æ–≥–µ
        - –ù–∞—Ä—É—à–µ–Ω–∏–µ —Ä–µ—á–∏ –∏–ª–∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è
        - –ê—Å–∏–º–º–µ—Ç—Ä–∏—è –ª–∏—Ü–∞
        - –°–∏–ª—å–Ω–∞—è –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å
        - –ù–∞—Ä—É—à–µ–Ω–∏–µ –∑—Ä–µ–Ω–∏—è
        - –ì–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å –ø–æ—Ç–µ—Ä–µ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏
        
        **–ù–ï–ú–ï–î–õ–ï–ù–ù–û –∑–≤–æ–Ω–∏—Ç–µ 103 –∏–ª–∏ 112!**
        
        ¬©Ô∏è 2025 –ú–æ–π –†–∏—Å–∫
        """)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    calculator = StrokeRiskCalculator()
    
    # –°–æ–∑–¥–∞–µ–º –≤–∫–ª–∞–¥–∫–∏
    tab1, tab2, tab3 = st.tabs(["üìã –ê–Ω–∫–µ—Ç–∞", "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã", "üìö –û–±—É—á–µ–Ω–∏–µ"])
    
    with tab1:
        st.header("–ê–Ω–∫–µ—Ç–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞")
        st.markdown("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∫–µ—Ç—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞")
        
        with st.form("stroke_risk_form"):
            col1, col2 = st.columns(2)
            
            with col1:
                # –î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
                st.subheader("–î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ")
                age = st.number_input(
                    "–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç)*",
                    min_value=15,
                    max_value=100,
                    value=45,
                    help="–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ - 15 –ª–µ—Ç"
                )
                
                gender = st.selectbox(
                    "–ü–æ–ª*",
                    ["–º—É–∂—Å–∫–æ–π", "–∂–µ–Ω—Å–∫–∏–π"]
                )
            
            with col2:
                # –ê–Ω—Ç—Ä–æ–ø–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
                st.subheader("–ê–Ω—Ç—Ä–æ–ø–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ")
                height_cm = st.number_input(
                    "–†–æ—Å—Ç (—Å–º)*",
                    min_value=100,
                    max_value=250,
                    value=170
                )
                
                weight_kg = st.number_input(
                    "–í–µ—Å (–∫–≥)*",
                    min_value=30,
                    max_value=200,
                    value=70
                )
                
                # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ò–ú–¢
                if height_cm > 0 and weight_kg > 0:
                    bmi, category = calculator.calculate_bmi(weight_kg, height_cm)
                    st.info(f"–í–∞—à –ò–ú–¢: {bmi} ({category})")
            
            st.divider()
            
            col1, col2 = st.columns(2)
            
            with col1:
                # –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è
                st.subheader("–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è")
                
                # –ù–û–í–´–ï –í–û–ü–†–û–°–´ –ü–û –¢–ó
                on_blood_pressure_meds = st.radio(
                    "–ü—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –ª–∏ –≤—ã –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è?*",
                    ["–¥–∞", "–Ω–µ—Ç"]
                )
                
                has_atrial_fibrillation = st.radio(
                    "–í—Ä–∞—á –∫–æ–≥–¥–∞-–ª–∏–±–æ –≥–æ–≤–æ—Ä–∏–ª –≤–∞–º –æ —Ç–æ–º, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ä–∏—Ç–º–∞ —Å–µ—Ä–¥—Ü–∞ (–º–µ—Ä—Ü–∞—Ç–µ–ª—å–Ω–∞—è –∞—Ä–∏—Ç–º–∏—è)?*",
                    ["–¥–∞", "–Ω–µ—Ç"]
                )
                
                previous_stroke_tia = st.radio(
                    "–í—Ä–∞—á –∫–æ–≥–¥–∞-–ª–∏–±–æ –≥–æ–≤–æ—Ä–∏–ª –≤–∞–º –æ —Ç–æ–º, —á—Ç–æ —É –≤–∞—Å –±—ã–ª –∏–Ω—Å—É–ª—å—Ç –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∏—Ç–æ—Ä–Ω–∞—è –∏—à–µ–º–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞ (\"–º–∏–∫—Ä–æ–∏–Ω—Å—É–ª—å—Ç\")?*",
                    ["–¥–∞", "–Ω–µ—Ç"]
                )
                
                has_diabetes = st.radio(
                    "–°–∞—Ö–∞—Ä–Ω—ã–π –¥–∏–∞–±–µ—Ç*",
                    ["–µ—Å—Ç—å", "–Ω–µ—Ç"]
                )
                
                family_stroke_history = st.radio(
                    "–ë—ã–ª –ª–∏ –∏–Ω—Å—É–ª—å—Ç —É –±–ª–∏–∑–∫–∏—Ö —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ (—Ä–æ–¥–∏—Ç–µ–ª–∏, –±—Ä–∞—Ç—å—è, —Å–µ—Å—Ç—Ä—ã)?*",
                    ["–¥–∞", "–Ω–µ—Ç"]
                )
                
            with col2:
                # –ò–∑–º–µ—Ä–µ–Ω–∏—è –∏ —Å–∏–º–ø—Ç–æ–º—ã
                st.subheader("–ò–∑–º–µ—Ä–µ–Ω–∏—è –∏ —Å–∏–º–ø—Ç–æ–º—ã")
                
                systolic_bp = st.number_input(
                    "–°–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ (–≤–µ—Ä—Ö–Ω–µ–µ, –º–º —Ä—Ç.—Å—Ç.)*",
                    min_value=80,
                    max_value=250,
                    value=120
                )
                
                diastolic_bp = st.number_input(
                    "–î–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ (–Ω–∏–∂–Ω–µ–µ, –º–º —Ä—Ç.—Å—Ç.)",
                    min_value=50,
                    max_value=150,
                    value=80
                )
                
                ldl_cholesterol = st.number_input(
                    "–•–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω –õ–ü–ù–ü (–º–º–æ–ª—å/–ª)",
                    min_value=0.0,
                    max_value=10.0,
                    value=3.0,
                    step=0.1,
                    help="–û–ø—Ç–∏–º–∞–ª—å–Ω–æ < 3.0 –º–º–æ–ª—å/–ª"
                )
                
                # –°–∏–º–ø—Ç–æ–º—ã (–¥–ª—è ABCD¬≤)
                if previous_stroke_tia == "–¥–∞":
                    st.subheader("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ —Å–∏–º–ø—Ç–æ–º–∞—Ö (–µ—Å–ª–∏ –±—ã–ª–∏)")
                    limb_weakness = st.checkbox("–ë—ã–ª–∞ —Å–ª–∞–±–æ—Å—Ç—å –≤ —Ä—É–∫–µ –∏–ª–∏ –Ω–æ–≥–µ")
                    speech_disturbance = st.checkbox("–ë—ã–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Ä–µ—á–∏")
                    if limb_weakness or speech_disturbance:
                        tia_symptom_duration = st.selectbox(
                            "–ö–∞–∫ –¥–æ–ª–≥–æ –¥–ª–∏–ª–∏—Å—å —Å–∏–º–ø—Ç–æ–º—ã?",
                            ["–º–µ–Ω–µ–µ 10 –º–∏–Ω—É—Ç", "10-59 –º–∏–Ω—É—Ç", "60 –º–∏–Ω—É—Ç –∏ –±–æ–ª–µ–µ"]
                        )
            
            st.divider()
            
            col1, col2 = st.columns(2)
            
            with col1:
                # –û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏
                st.subheader("–û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏")
                
                smoking = st.selectbox(
                    "–ö—É—Ä–µ–Ω–∏–µ*",
                    ["–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∫—É—Ä–∏–ª", "–∫—É—Ä–∏–ª –≤ –ø—Ä–æ—à–ª–æ–º", "–∫—É—Ä—è—â–∏–π"]
                )
                
                activity_level = st.selectbox(
                    "–û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏*",
                    ["–ø–æ–¥–≤–∏–∂–Ω—ã–π", "–º–∞–ª–æ–ø–æ–¥–≤–∏–∂–Ω—ã–π", "–Ω–µ–ø–æ–¥–≤–∏–∂–Ω—ã–π"],
                    help="–ü–æ–¥–≤–∏–∂–Ω—ã–π: —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏. –ù–µ–ø–æ–¥–≤–∏–∂–Ω—ã–π: –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —Å–∏–¥—è—á–∏–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏"
                )
            
            with col2:
                # –°–∏–º–ø—Ç–æ–º—ã
                st.subheader("–°–∏–º–ø—Ç–æ–º—ã (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü)")
                
                palpitations = st.selectbox(
                    "–£—á–∞—â–µ–Ω–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏–µ*",
                    ["–Ω–∏–∫–æ–≥–¥–∞", "—Ä–µ–¥–∫–æ", "—á–∞—Å—Ç–æ"]
                )
                
                shortness_of_breath = st.selectbox(
                    "–û—â—É—â–µ–Ω–∏–µ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –≤–æ–∑–¥—É—Ö–∞ –≤–æ –≤—Ä–µ–º—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫*",
                    ["–Ω–∏–∫–æ–≥–¥–∞", "—Ä–µ–¥–∫–æ", "—á–∞—Å—Ç–æ"]
                )
                
                dizziness_fainting = st.selectbox(
                    "–ì–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –æ–±–º–æ—Ä–æ–∫–∏*",
                    ["–Ω–∏–∫–æ–≥–¥–∞", "—Ä–µ–¥–∫–æ", "—á–∞—Å—Ç–æ"]
                )
            
            # –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
            submitted = st.form_submit_button("üìà –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∏—Å–∫", type="primary")
            
            if submitted:
                # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                user_data = {
                    'age': age,
                    'gender': gender,
                    'height_cm': height_cm,
                    'weight_kg': weight_kg,
                    'on_blood_pressure_meds': on_blood_pressure_meds == "–¥–∞",
                    'has_atrial_fibrillation': has_atrial_fibrillation == "–¥–∞",
                    'previous_stroke_tia': previous_stroke_tia == "–¥–∞",
                    'has_diabetes': has_diabetes == "–µ—Å—Ç—å",
                    'family_stroke_history': family_stroke_history == "–¥–∞",
                    'systolic_bp': systolic_bp,
                    'diastolic_bp': diastolic_bp,
                    'ldl_cholesterol': ldl_cholesterol,
                    'smoking': smoking,
                    'activity_level': activity_level,
                    'palpitations': palpitations,
                    'shortness_of_breath': shortness_of_breath,
                    'dizziness_fainting': dizziness_fainting,
                }
                
                # –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è ABCD¬≤ –µ—Å–ª–∏ –±—ã–ª–∏
                if previous_stroke_tia == "–¥–∞":
                    user_data['limb_weakness'] = 'limb_weakness' in locals() and limb_weakness
                    user_data['speech_disturbance'] = 'speech_disturbance' in locals() and speech_disturbance
                    if 'tia_symptom_duration' in locals():
                        duration_map = {
                            "–º–µ–Ω–µ–µ 10 –º–∏–Ω—É—Ç": 5,
                            "10-59 –º–∏–Ω—É—Ç": 30,
                            "60 –º–∏–Ω—É—Ç –∏ –±–æ–ª–µ–µ": 60
                        }
                        user_data['tia_symptom_duration'] = duration_map.get(tia_symptom_duration, 0)
                
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Å—Å–∏–∏
                st.session_state.user_data = user_data
                st.session_state.calculated = True
                st.rerun()
    
    with tab2:
        st.header("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ü–µ–Ω–∫–∏")
        
        if not st.session_state.get('calculated', False):
            st.info("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∫–µ—Ç—É –≤–æ –≤–∫–ª–∞–¥–∫–µ '–ê–Ω–∫–µ—Ç–∞' –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
        else:
            user_data = st.session_state.user_data
            
            try:
                # –†–∞—Å—á–µ—Ç —Ä–∏—Å–∫–∞
                result = calculator.calculate_overall_risk(user_data)
                
                # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                col1, col2 = st.columns([2, 1])
                
                with col1:
                    # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç - —Ä–∏—Å–∫ –Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤
                    st.subheader("üìä –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤")
                    
                    # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∏—Å–∫–∞
                    fig = go.Figure(go.Indicator(
                        mode="gauge+number",
                        value=result.six_month_risk,
                        domain={'x': [0, 1], 'y': [0, 1]},
                        title={'text': f"–†–∏—Å–∫ –∏–Ω—Å—É–ª—å—Ç–∞ –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤ (%)"},
                        gauge={
                            'axis': {'range': [None, 15]},
                            'bar': {'color': "darkblue"},
                            'steps': [
                                {'range': [0, 1], 'color': "lightgreen"},
                                {'range': [1, 3], 'color': "yellow"},
                                {'range': [3, 10], 'color': "orange"},
                                {'range': [10, 15], 'color': "red"}
                            ],
                            'threshold': {
                                'line': {'color': "red", 'width': 4},
                                'thickness': 0.75,
                                'value': result.six_month_risk
                            }
                        }
                    ))
                    
                    fig.update_layout(height=300, margin=dict(l=20, r=20, t=50, b=20))
                    st.plotly_chart(fig, use_container_width=True)
                    
                    # –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
                    risk_class = f"risk-{result.risk_level.value.lower()}"
                    risk_text = f"""
                    <div class="{risk_class}">
                        <h3>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: {result.risk_level.value}</h3>
                        <p>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∏–Ω—Å—É–ª—å—Ç–∞ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 6 –º–µ—Å—è—Ü–µ–≤: <b>{result.six_month_risk}%</b></p>
                    </div>
                    """
                    st.markdown(risk_text, unsafe_allow_html=True)
                
                with col2:
                    # –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ò–ú–¢
                    st.subheader("üìà –í–∞—à–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏")
                    
                    # –ò–ú–¢
                    st.metric(
                        label="–ò–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ (–ò–ú–¢)",
                        value=f"{result.bmi}",
                        delta=result.bmi_category,
                        delta_color="normal"
                    )
                    
                    # Framingham Score
                    st.metric(
                        label="–ë–∞–ª–ª—ã –ø–æ —à–∫–∞–ª–µ Framingham",
                        value=result.framingham_score
                    )
                    
                    # ABCD¬≤ –µ—Å–ª–∏ –µ—Å—Ç—å
                    if result.abcd2_score is not None:
                        st.metric(
                            label="–ë–∞–ª–ª—ã –ø–æ —à–∫–∞–ª–µ ABCD¬≤",
                            value=result.abcd2_score
                        )
                    
                    # CHA‚ÇÇDS‚ÇÇ-VASc –µ—Å–ª–∏ –µ—Å—Ç—å
                    if result.chads2_vasc_score is not None:
                        st.metric(
                            label="–ë–∞–ª–ª—ã –ø–æ —à–∫–∞–ª–µ CHA‚ÇÇDS‚ÇÇ-VASc",
                            value=result.chads2_vasc_score
                        )
                
                st.divider()
                
                # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                st.subheader("üí° –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏")
                for i, recommendation in enumerate(result.recommendations, 1):
                    st.markdown(f"{i}. {recommendation}")
                
                # –ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏
                if result.warning_flags:
                    st.divider()
                    st.subheader("üö® –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ!")
                    st.markdown('<div class="warning-box">', unsafe_allow_html=True)
                    st.warning("–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ñ–∞–∫—Ç–æ—Ä—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è –≤—Ä–∞—á–∞:")
                    for flag in result.warning_flags:
                        st.markdown(f"‚Ä¢ {flag}")
                    st.markdown('</div>', unsafe_allow_html=True)
                
                # –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–æ–≤
                with st.expander("üìã –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–æ–≤"):
                    st.write("**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —à–∫–∞–ª—ã:**")
                    st.write("1. **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∫–∞–ª–∞ Framingham** - –¥–ª—è –æ—Ü–µ–Ω–∫–∏ 6-–º–µ—Å—è—á–Ω–æ–≥–æ —Ä–∏—Å–∫–∞")
                    st.write("2. **–®–∫–∞–ª–∞ ABCD¬≤** - –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ –ø–æ—Å–ª–µ –¢–ò–ê (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)")
                    st.write("3. **–®–∫–∞–ª–∞ CHA‚ÇÇDS‚ÇÇ-VASc** - –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ –ø—Ä–∏ –º–µ—Ä—Ü–∞—Ç–µ–ª—å–Ω–æ–π –∞—Ä–∏—Ç–º–∏–∏")
                    
                    st.write("\n**–í–∞—à–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞:**")
                    framingham_score, _, risk_factors = calculator.calculate_framingham_6month_risk(user_data)
                    for factor in risk_factors[:5]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø-5 —Ñ–∞–∫—Ç–æ—Ä–æ–≤
                        st.write(f"‚Ä¢ {factor}")
                
            except ValueError as e:
                st.error(str(e))
            except Exception as e:
                st.error(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ: {str(e)}")
                st.info("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
    
    with tab3:
        st.header("üìö –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å")
        st.markdown("–£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö –∏–Ω—Å—É–ª—å—Ç–∞ –∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–µ")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.subheader("üß† –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–Ω—Å—É–ª—å—Ç–∞ (FAST+)")
            
            st.markdown("""
            **F** - Face (–ª–∏—Ü–æ):
            ‚Ä¢ –ê—Å–∏–º–º–µ—Ç—Ä–∏—è –ª–∏—Ü–∞
            ‚Ä¢ –û–ø—É—â–µ–Ω–∏–µ —É–≥–æ–ª–∫–∞ —Ä—Ç–∞
            ‚Ä¢ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ª—ã–±–Ω—É—Ç—å—Å—è
            
            **A** - Arms (—Ä—É–∫–∏):
            ‚Ä¢ –°–ª–∞–±–æ—Å—Ç—å –∏–ª–∏ –æ–Ω–µ–º–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–π —Ä—É–∫–µ
            ‚Ä¢ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–Ω—è—Ç—å –æ–±–µ —Ä—É–∫–∏
            
            **S** - Speech (—Ä–µ—á—å):
            ‚Ä¢ –ù–µ—Ä–∞–∑–±–æ—Ä—á–∏–≤–∞—è —Ä–µ—á—å
            ‚Ä¢ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–Ω—è—Ç—å –æ–±—Ä–∞—â–µ–Ω–Ω—É—é —Ä–µ—á—å
            ‚Ä¢ –°–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å —Å–æ–∑–Ω–∞–Ω–∏—è
            
            **T** - Time (–≤—Ä–µ–º—è):
            ‚Ä¢ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–≤–æ–Ω–∏—Ç–µ 103 –∏–ª–∏ 112!
            ‚Ä¢ –ö–∞–∂–¥–∞—è –º–∏–Ω—É—Ç–∞ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ
            """)
            
            # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç
            with st.expander("‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–±—è: –±—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç"):
                st.markdown("""
                **–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ —Å–∏–º–ø—Ç–æ–º—ã:**
                1. –ù–µ –∂–¥–∏—Ç–µ, –ø–æ–∫–∞ —Å–∏–º–ø—Ç–æ–º—ã –ø—Ä–æ–π–¥—É—Ç
                2. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–π—Ç–µ —Å–∫–æ—Ä—É—é (103 –∏–ª–∏ 112)
                3. –ó–∞–ø–æ–º–Ω–∏—Ç–µ –≤—Ä–µ–º—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–≤—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤
                4. –ù–µ –¥–∞–≤–∞–π—Ç–µ —á–µ–ª–æ–≤–µ–∫—É –µ–¥—É, –≤–æ–¥—É –∏–ª–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
                5. –£–ª–æ–∂–∏—Ç–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–µ–≥–æ —Å –ø—Ä–∏–ø–æ–¥–Ω—è—Ç–æ–π –≥–æ–ª–æ–≤–æ–π
                6. –†–∞—Å—Å—Ç–µ–≥–Ω–∏—Ç–µ —Ç–µ—Å–Ω—É—é –æ–¥–µ–∂–¥—É
                7. –ü—Ä–∏ —Ä–≤–æ—Ç–µ –ø–æ–≤–µ—Ä–Ω–∏—Ç–µ –≥–æ–ª–æ–≤—É –Ω–∞–±–æ–∫
                """)
        
        with col2:
            st.subheader("‚ö†Ô∏è –ê—Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (—á–∞—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è)")
            
            st.markdown("""
            **–£ –∂–µ–Ω—â–∏–Ω —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è:**
            ‚Ä¢ –í–Ω–µ–∑–∞–ø–Ω–∞—è –∏–∫–æ—Ç–∞ + —Ç–æ—à–Ω–æ—Ç–∞
            ‚Ä¢ –ë–æ–ª—å –≤ –≥—Ä—É–¥–∏ –∏–ª–∏ —Å–ø–∏–Ω–µ
            ‚Ä¢ –°–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å —Å–æ–∑–Ω–∞–Ω–∏—è
            ‚Ä¢ –û–±—â–∞—è —Å–ª–∞–±–æ—Å—Ç—å
            ‚Ä¢ –£—á–∞—â–µ–Ω–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏–µ
            
            **–£ –º–æ–ª–æ–¥—ã—Ö –ª—é–¥–µ–π:**
            ‚Ä¢ "–ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è" –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å
            ‚Ä¢ –í–Ω–µ–∑–∞–ø–Ω–∞—è –∞–≥—Ä–µ—Å—Å–∏—è –∏–ª–∏ –∞–ø–∞—Ç–∏—è
            ‚Ä¢ –ù–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏
            ‚Ä¢ –î–≤–æ–µ–Ω–∏–µ –≤ –≥–ª–∞–∑–∞—Ö
            
            **–£ –ø–æ–∂–∏–ª—ã—Ö:**
            ‚Ä¢ –í–Ω–µ–∑–∞–ø–Ω–æ–µ –≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ
            ‚Ä¢ –ü–æ—Ç–µ—Ä—è —Å–æ–∑–Ω–∞–Ω–∏—è –±–µ–∑ —Å—É–¥–æ—Ä–æ–≥
            ‚Ä¢ –í–Ω–µ–∑–∞–ø–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
            ‚Ä¢ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–Ω—è—Ç—å, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—à—å—Å—è
            """)
            
            # –ò–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞ TIA
            with st.expander("üîÑ –ß—Ç–æ —Ç–∞–∫–æ–µ –¢–ò–ê (–º–∏–∫—Ä–æ–∏–Ω—Å—É–ª—å—Ç)?"):
                st.markdown("""
                **–¢—Ä–∞–Ω–∑–∏—Ç–æ—Ä–Ω–∞—è –∏—à–µ–º–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞ (–¢–ò–ê)** ‚Äî —ç—Ç–æ "–ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç–µ–ª—å–Ω—ã–π" –∏–Ω—Å—É–ª—å—Ç:
                
                üîπ –°–∏–º–ø—Ç–æ–º—ã –¥–ª—è—Ç—Å—è –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç –¥–æ —á–∞—Å–∞
                üîπ –ü—Ä–æ—Ö–æ–¥—è—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
                üîπ –ù–ï –æ—Å—Ç–∞–≤–ª—è—é—Ç —Å—Ç–æ–π–∫–∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π
                
                **–ù–û:** –ø–æ—Å–ª–µ –¢–ò–ê —Ä–∏—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∏–Ω—Å—É–ª—å—Ç–∞ –≤ –ø–µ—Ä–≤—ã–µ 48 —á–∞—Å–æ–≤ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 4-8%!
                
                **–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –¢–ò–ê:**
                1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–π—Ç–µ —Å–∫–æ—Ä—É—é, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∏–º–ø—Ç–æ–º—ã –ø—Ä–æ—à–ª–∏
                2. –ù–µ –æ—Ç–∫–∞–∑—ã–≤–∞–π—Ç–µ—Å—å –æ—Ç –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
                3. –ü—Ä–æ–π–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
                4. –ù–∞—á–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ª–µ—á–µ–Ω–∏–µ
                """)
        
        st.divider()
        
        # –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞
        st.subheader("üõ°Ô∏è –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –∏–Ω—Å—É–ª—å—Ç–∞")
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            st.markdown("**–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–≤–ª–µ–Ω–∏—è:**")
            st.markdown("""
            ‚Ä¢ –ò–∑–º–µ—Ä—è–π—Ç–µ –ê–î —Ä–µ–≥—É–ª—è—Ä–Ω–æ
            ‚Ä¢ –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: < 140/90
            ‚Ä¢ –ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é
            ‚Ä¢ –°–Ω–∏–∂–∞–π—Ç–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–æ–ª–∏
            """)
        
        with col2:
            st.markdown("**–ó–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏:**")
            st.markdown("""
            ‚Ä¢ 150 –º–∏–Ω –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –Ω–µ–¥–µ–ª—é
            ‚Ä¢ 5 –ø–æ—Ä—Ü–∏–π –æ–≤–æ—â–µ–π/—Ñ—Ä—É–∫—Ç–æ–≤ –≤ –¥–µ–Ω—å
            ‚Ä¢ –û—Ç–∫–∞–∑ –æ—Ç –∫—É—Ä–µ–Ω–∏—è
            ‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∞–ª–∫–æ–≥–æ–ª—è
            """)
        
        with col3:
            st.markdown("**–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:**")
            st.markdown("""
            ‚Ä¢ –î–∏—Å–ø–∞–Ω—Å–µ—Ä–∏–∑–∞—Ü–∏—è 1 —Ä–∞–∑ –≤ –≥–æ–¥
            ‚Ä¢ –ö–æ–Ω—Ç—Ä–æ–ª—å —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω–∞
            ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –≥–ª—é–∫–æ–∑—ã
            ‚Ä¢ –≠–ö–ì –ø—Ä–∏ —Å–∏–º–ø—Ç–æ–º–∞—Ö
            """)
    
    # –§—É—Ç–µ—Ä —Å –∫–æ–ø–∏—Ä–∞–π—Ç–æ–º
    st.markdown("""
    <div class="footer">
        <hr>
        <p>¬©Ô∏è 2025 –ú–æ–π –†–∏—Å–∫ ‚Äî –ü—Ä–æ—Å–≤–µ—Ç–∏—Ç–µ–ª—å—Å–∫–æ-–ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ –∏–Ω—Å—É–ª—å—Ç–∞</p>
        <p><em>–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –≤—Ä–∞—á–∞. –ü—Ä–∏ —Å–∏–º–ø—Ç–æ–º–∞—Ö –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â—å—é.</em></p>
    </div>
    """, unsafe_allow_html=True)


if __name__ == "__main__":
    if 'calculated' not in st.session_state:
        st.session_state.calculated = False
    if 'user_data' not in st.session_state:
        st.session_state.user_data = {}
    
    main()
